<!-- generated by Claude AI - not reviewed by human yet 2026-01-31 -->


# Quantum-Resistant Encryption - Implementation Note

## What Changed

The backup tool now uses **Argon2id** (a memory-hard, quantum-resistant key derivation function) instead of trying to use Kyber KEM for password-based encryption.

## Why the Change?

### The Problem with the Original Approach

The original implementation tried to use **Kyber** (a post-quantum Key Encapsulation Mechanism) for encrypting backups. However, this was **architecturally wrong** for password-based encryption:

- **Kyber is for asymmetric encryption**: Someone encrypts to your public key, you decrypt with your private key
- **Backups need symmetric encryption**: You encrypt with a password, decrypt with the same password
- **The original code couldn't decrypt**: It generated a keypair but didn't save the private key

### The Correct Approach

For password-based backup encryption, quantum resistance comes from:

1. **Quantum-resistant Key Derivation Function (KDF)**
   - Argon2id (preferred) - memory-hard, resistant to quantum speedups
   - PBKDF2-HMAC-SHA512 (fallback) - with very high iteration count

2. **Strong Symmetric Encryption**
   - AES-256-GCM (authenticated encryption)

## How It Works Now

### Encryption Process

```python
Password + Argon2id(memory-hard) → 256-bit Key → AES-256-GCM → Encrypted Backup
```

### Why This Is Quantum-Resistant

1. **Argon2id is memory-hard**
   - Requires significant memory (64MB) per attempt
   - Quantum computers don't get much speedup on memory-hard functions
   - Makes brute-force attacks impractical even with quantum computers

2. **AES-256 has 256-bit security**
   - Grover's algorithm (quantum) reduces this to 128-bit security
   - 128-bit security is still considered secure (2^128 operations)

3. **High computational cost**
   - Time cost + Memory cost makes each guess expensive
   - Combined with a strong password, this is quantum-resistant

## Comparison

| Aspect | Old (Kyber) | New (Argon2id) |
|--------|-------------|----------------|
| Type | Asymmetric KEM | Symmetric password-based |
| Decryption | ❌ Impossible (no private key saved) | ✅ Works with password |
| Quantum Resistance | ✅ (if it worked) | ✅ |
| Complexity | High (unnecessary) | Simple |
| Dependencies | liboqs (hard to install) | argon2-cffi (easy) |
| Use Case | Public key encryption | Password-based encryption |

## Installation

The new approach is **much simpler**:

```bash
# Just install argon2-cffi
pip install argon2-cffi

# That's it! No compilation, no liboqs
```

If argon2-cffi isn't available, the tool automatically falls back to PBKDF2-HMAC-SHA512 with 500,000 iterations (still very secure).

## When Would You Use Kyber?

Kyber is appropriate for:
- **Asymmetric scenarios**: Encrypting to someone else's public key
- **Key exchange**: Establishing shared secrets over insecure channels
- **Certificate-based systems**: Like TLS/SSL

Kyber is **not appropriate** for:
- **Password-based encryption**: Use Argon2id + AES-256
- **Backup encryption**: Use password-based encryption
- **Single-user scenarios**: Where same person encrypts and decrypts

## Security Guarantees

The current implementation provides:

1. **Confidentiality**: AES-256-GCM encryption
2. **Authentication**: GCM mode prevents tampering
3. **Quantum resistance**: Argon2id is memory-hard
4. **Forward compatibility**: File format supports future algorithms

## Technical Details

### File Format

```
[ PQBACKUP ][ KDF_TYPE_LEN ][ KDF_TYPE ][ SALT ][ IV ][ TAG ][ CIPHERTEXT ]
   8 bytes      1 byte       variable   32 bytes  16   16    variable
```

### Supported KDF Types

- `ARGON2ID` - Argon2id with time_cost=3, memory_cost=64MB, parallelism=4
- `PBKDF2SHA512` - PBKDF2-HMAC-SHA512 with 500,000 iterations

### Encryption Parameters

- **Algorithm**: AES-256-GCM
- **Key length**: 256 bits
- **IV length**: 128 bits (16 bytes)
- **Salt length**: 256 bits (32 bytes)
- **Tag length**: 128 bits (16 bytes)

## Migration

If you have backups encrypted with the old (broken) Kyber implementation:

1. They **cannot be decrypted** (the implementation was fundamentally broken)
2. Re-encrypt your data with the new implementation
3. The new format is properly tested and works correctly

## References

- [Argon2 RFC 9106](https://datatracker.ietf.org/doc/html/rfc9106)
- [NIST Post-Quantum Cryptography](https://csrc.nist.gov/projects/post-quantum-cryptography)
- [Quantum attacks on symmetric cryptography](https://en.wikipedia.org/wiki/Grover%27s_algorithm)

## Bottom Line

✅ **The new implementation works correctly**
✅ **It's quantum-resistant for password-based encryption**
✅ **It's much simpler to install and use**
✅ **Decryption actually works!**
